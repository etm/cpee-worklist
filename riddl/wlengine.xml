<description xmlns="http://riddl.org/ns/description/1.0" xmlns:ann="http://riddl.org/ns/annotation/1.0" xmlns:xi="http://www.w3.org/2001/XInclude" datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes">
  <message name="activity"> <!--{{{-->
    <parameter name="orgmodel" type="string"/>
    <parameter name="domain" type="string"/>
    <parameter name="form" type="string"/>
    <choice>
      <parameter name="unit" type="string"/>
      <parameter name="role" type="string"/>
      <group>
        <parameter name="unit" type="string"/>
        <parameter name="role" type="string"/>
      </group>
    </choice>  
    <zeroOrMore>
      <parameter name="*" type="string"/>
    </zeroOrMore>
  </message> <!--}}}-->

  <message name="session">
    <parameter name="id" type="string">
      <param name="pattern">[a-f0-9]{32}</param> <!-- Digest::MD5.hexdigest(Kernel::rand().to_s) -->
    </parameter>  
    <optional>
      <parameter name="url" type="string"/>
    </optional>
  </message>
  <message name="take">
    <parameter name="operation" fixed="take"/>
  </message>
  <message name="giveback">
    <parameter name="operation" fixed="giveback"/>
  </message>
  <message name="details">
    <parameter name="callbackurl" type="string"/>
    <parameter name="formurl" type="string"/>
    <parameter name="parameters" type="string"/>
  </message>

  <message name="domains">
    <parameter name="return" mimetype="text/xml" handler="http://riddl.org/ns/handlers/relaxng">
     <!--  <xi:include href="xxxx.rng"/> -->
    </parameter>            
  </message>
  <message name="users">
    <parameter name="return" mimetype="text/xml"/>
  </message>
  <message name="tasks">
    <parameter name="return" mimetype="text/xml"/>
  </message>
  <message name="json_details">
    <parameter name="operation" fixed="json"/>
  </message>
  <message name="json">
    <parameter name="data" mimetype="application/json"/>
  </message>

  <resource>
    <get in="*" out="domains"/>
    <post in="activity"/>
    <resource> <!-- domain -->
      <get out="users"/>
      <resource> <!-- user -->
        <post in="session"/>
        <websocket/>
        <resource relative="tasks">
          <get out="tasks"/>
          <resource> <!-- task -->
            <get out="details"/>
            <get in="json_details" out="json"/>
            <put in="take"/>
            <put in="giveback"/>
            <delete/>
          </resource>
        </resource>
      </resource>
    </resource>
  </resource>
</description>
